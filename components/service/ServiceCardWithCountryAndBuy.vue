<template>
  <div class="services-el">
    <div class="flex gap-2">
      <div class="services-el__img">
        <img :src="imgService" />
      </div>
      <span class="services-el__name">{{ account.servName }}</span>
    </div>
    <template v-if="account.count">
      <span class="services-el__quantity"> {{ account.count }} {{ $t('pc') }}</span>
    </template>
    <UiBaseCounter size="sm" @count="count"/>
    <template v-if="account.prices">
      <UiBaseButton
          class="services-el__btn"
          size="lg"
          icon="icon-pva__bag"
          :label="labelService"
          @click="buyService"
      ></UiBaseButton>
    </template>
  </div>
</template>

<script setup>
const { locale } = useI18n();
const props = defineProps({
  account: {
    type: Object,
    required: true,
  },
});

const urlAmazonCountry = 'https://smsactivate.s3.eu-central-1.amazonaws.com/assets/ico/country/';
const labelService =  `$${props.account.prices.def}`;
const imgService = `${urlAmazonCountry}${props.account.country}.svg`;
const amount = ref(1)
const count = (ev) => {
  amount.value = ev.value
}


import { buyActivation } from '~/components/api/fetchBuyActivation';
import apiBuyService from '~/components/api/AuthAPI'
const buyService = async () => {
  const params = {
    service: props.account.service, // service short name
    retail_price: props.account.prices.def, // int
    country_code: props.account.country, // country code int
    amount: amount.value
  }
  const token = localStorage.getItem('authToken')
  const buyActivationResult = await apiBuyService.buyActivation(params, token)

  if (!buyActivationResult.error.value) {
    console.log("покупка прошла", params)
  }
}
</script>

<style scoped lang="scss">
@import '~/assets/css/mixins.scss';

.services-el {

  @apply bg-sky-50 rounded-lg p-5  grid gap-x-2 gap-y-4 justify-between grid-cols-[141px_100px] sm:gap-4 sm:grid-cols-[1fr_auto_auto_auto] items-center;

  &.active{
    @apply bg-sky-600 text-white;
  }

  &__img {
    @apply bg-sky-50 rounded overflow-hidden w-6 h-6 md:w-8 md:h-8 shrink-0;

    img {
      @apply max-w-full;
    }
  }

  &__name {
    @apply truncate  mr-2  md:mr-0 text-base dark:text-stone-500;
  }

  &__quantity {
    @apply block text-xs ml-[auto] shrink-0 text-stone-500;
  }

  &__btn {
    @apply ml-[auto]  min-w-[78px] md:ml-0 text-base md:min-w-[94px] md:max-w-[96px] h-full;
  }
}
</style>